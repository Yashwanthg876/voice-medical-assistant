{% extends "base.html" %}
{% block content %}

<div class="card">
    <h2 class="title">Medical AI Chatbot</h2>
    <p class="subtitle">
        Ask questions about symptoms, conditions, precautions, and medications.
        Responses are informational and not a substitute for professional care.
    </p>
</div>

<div class="card" style="display:flex; flex-direction:column; height:520px;">

    <!-- CHAT WINDOW -->
    <div id="chatBox"
         style="flex:1; overflow-y:auto; padding-right:10px;">

        <div style="margin-bottom:18px; padding:16px;
                    background:#f1f5f9; border-radius:14px;">
            <strong>MedAssist AI</strong><br>
            Hello. I am your medical AI assistant.
            You may describe symptoms or ask health-related questions.
        </div>

    </div>

    <!-- INPUT -->
    <div style="margin-top:20px; display:flex;">
        <input id="userInput"
               placeholder="Describe your symptoms or ask a medical question..."
               style="flex:1; padding:14px;
                      border-radius:14px;
                      border:1px solid #cbd5e1;
                      font-size:15px;">

        <button class="btn btn-primary"
                onclick="sendMessage()"
                style="margin-left:12px;">
            Send
        </button>
    </div>

</div>

<script>
async function sendMessage() {
    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if (!message) return;

    appendUser(message);
    input.value = "";

    try {
        const res = await fetch("/chatbot_api", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await res.json();
        appendAI(data.reply);

    } catch (err) {
        appendAI("Unable to connect to the server. Please try again.");
    }
}

function appendUser(text) {
    const box = document.getElementById("chatBox");
    const div = document.createElement("div");

    div.style.marginBottom = "18px";
    div.style.padding = "16px";
    div.style.background =
        "linear-gradient(135deg, #2563eb, #38bdf8)";
    div.style.color = "white";
    div.style.borderRadius = "14px";
    div.style.maxWidth = "80%";
    div.style.marginLeft = "auto";

    div.innerHTML = "<strong>You</strong><br>" + text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}

function appendAI(text) {
    const box = document.getElementById("chatBox");
    const div = document.createElement("div");

    div.style.marginBottom = "18px";
    div.style.padding = "16px";
    div.style.background = "#f1f5f9";
    div.style.borderRadius = "14px";
    div.style.maxWidth = "80%";

    div.innerHTML =
        "<strong>MedAssist AI</strong><br>" +
        text.replace(/\n/g, "<br>");

    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}
</script>

{% endblock %}